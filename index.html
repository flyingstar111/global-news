<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒçƒ­ç‚¹æ–°é—»èšåˆ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f7f9; }
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        h1 { color: #333; text-align: center; margin-bottom: 20px; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px; }
        .controls button { padding: 10px 15px; border: 1px solid #ccc; border-radius: 20px; background-color: #fff; cursor: pointer; white-space: nowrap; }
        .controls button.active { background-color: #007bff; color: #fff; border-color: #007bff; }
        .news-list { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .news-card { background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); display: flex; gap: 15px; text-decoration: none; color: #333; }
        .news-content { flex-grow: 1; }
        .news-title { font-size: 1.1em; font-weight: bold; margin-bottom: 5px; }
        .news-meta { font-size: 0.85em; color: #6c757d; }
        .news-image { width: 100px; height: 80px; object-fit: cover; border-radius: 4px; flex-shrink: 0; }
        .status-message { text-align: center; padding: 50px; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h1>å…¨çƒçƒ­ç‚¹æ–°é—»èšåˆ</h1>
    <div class="controls" id="country-controls"></div>
    <div class="news-list" id="news-list">
        <p class="status-message">æ­£åœ¨åŠ è½½æ–°é—»...</p>
    </div>
</div>

<script>
    // =========================================================
    // ğŸ”´ ğŸ”´ ğŸ”´ é…ç½®åŒºåŸŸ (è¯·åŠ¡å¿…ä¿®æ”¹è¿™é‡Œ) ğŸ”´ ğŸ”´ ğŸ”´
    // =========================================================
    
    // 1. æ‚¨çš„ GNews API Key
    const API_KEY = "24f6c5073b941092284245f93c9cb217";
    
    // 2. æ‚¨çš„ Cloudflare Worker çœŸå®ç½‘å€
    // âŒ ä¸è¦ç›´æ¥ç”¨ gnews-proxy.yourname.workers.dev
    // âœ… å» Cloudflare åå°å¤åˆ¶æ‚¨çš„çœŸå®ç½‘å€ï¼Œä¾‹å¦‚: https://gnews-proxy.abcd-1234.workers.dev
    const BASE_URL = "https://gnews-proxy.flyingstar998.workers.dev"; 

    // =========================================================

    const COUNTRIES = { "us": "ç¾å›½", "gb": "è‹±å›½", "cn": "ä¸­å›½", "jp": "æ—¥æœ¬" };
    let currentCountry = 'us'; 
    const newsListEl = document.getElementById('news-list');
    const controlsEl = document.getElementById('country-controls');

    async function fetchNews(countryCode) {
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¿˜è®°æ›¿æ¢ç½‘å€
        if (BASE_URL.includes("yourname.workers.dev")) {
            newsListEl.innerHTML = '<p class="status-message" style="color: red; font-weight:bold;">é…ç½®é”™è¯¯ï¼šæ‚¨å¿˜è®°åœ¨ä»£ç ä¸­æ›¿æ¢ BASE_URL äº†ï¼<br>è¯·å» Cloudflare å¤åˆ¶çœŸå®çš„ Worker ç½‘å€ã€‚</p>';
            return;
        }

        newsListEl.innerHTML = '<p class="status-message">æ­£åœ¨åŠ è½½ ' + COUNTRIES[countryCode] + ' çš„æ–°é—»...</p>';
        
        try {
            const url = `${BASE_URL}?country=${countryCode}&token=${API_KEY}`;
            const response = await fetch(url);

            // å¤„ç† Worker è¿”å›çš„é 200 é”™è¯¯ (æ¯”å¦‚ 429)
            if (!response.ok) {
                 const errorData = await response.json().catch(() => ({}));
                 const errorMessage = errorData.errors ? errorData.errors[0].message : `ä»£ç†è®¿é—®å¤±è´¥ (çŠ¶æ€ç : ${response.status})`;
                 newsListEl.innerHTML = `<p class="status-message" style="color: red;">${errorMessage}</p>`;
                 return;
            }

            const data = await response.json();

            // å¤„ç† GNews è¿”å›çš„ä¸šåŠ¡é”™è¯¯
            if (data.errors) {
                 newsListEl.innerHTML = '<p class="status-message" style="color: red;">API é”™è¯¯: ' + data.errors[0].message + '</p>';
                 return;
            }

            if (data.articles && data.articles.length > 0) {
                renderNews(data.articles);
            } else {
                newsListEl.innerHTML = '<p class="status-message">æœªè·å–åˆ°æ–°é—»ã€‚å¯èƒ½è¯¥å›½å®¶/åœ°åŒºå…è´¹ç‰ˆä¸æ”¯æŒï¼Œè¯·åˆ‡æ¢åˆ°ã€ç¾å›½ã€‘è¯•è¯•ã€‚</p>';
            }

        } catch (error) {
            console.error("Fetch Error:", error);
            newsListEl.innerHTML = '<p class="status-message" style="color: red;">ç½‘ç»œè¿æ¥å¤±è´¥ã€‚è¯·æ£€æŸ¥ BASE_URL æ˜¯å¦å¡«å†™æ­£ç¡®ï¼Œæˆ–è€…æ˜¯å¦å¼€å¯äº† VPNã€‚</p>';
        }
    }

    function renderNews(articles) {
        newsListEl.innerHTML = ''; 
        articles.forEach(article => {
            if (!article.title || !article.url) return;
            const card = document.createElement('a');
            card.className = 'news-card';
            card.href = article.url;
            card.target = '_blank';
            const date = new Date(article.publishedAt).toLocaleDateString();
            card.innerHTML = `
                <div class="news-content">
                    <div class="news-title">${article.title}</div>
                    <div class="news-meta">${article.source.name} Â· ${date}</div>
                </div>
                ${article.image ? `<img src="${article.image}" class="news-image">` : ''}
            `;
            newsListEl.appendChild(card);
        });
    }

    function setupControls() {
        Object.keys(COUNTRIES).forEach(code => {
            const button = document.createElement('button');
            button.textContent = COUNTRIES[code];
            if (code === currentCountry) button.classList.add('active');
            button.onclick = () => {
                document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
                button.classList.add('active');
                currentCountry = code;
                fetchNews(code);
            };
            controlsEl.appendChild(button);
        });
    }

    setupControls();
    fetchNews(currentCountry);
</script>
</body>
</html>
