<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒçƒ­ç‚¹æ–°é—»èšåˆ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f7f9; }
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        h1 { color: #333; text-align: center; margin-bottom: 20px; }
        
        /* æç¤ºæ¡æ ·å¼ */
        .tip-bar { background-color: #e3f2fd; color: #0d47a1; padding: 10px; border-radius: 8px; font-size: 0.9em; text-align: center; margin-bottom: 20px; border: 1px solid #bbdefb; }

        .controls { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px; }
        .controls button { padding: 8px 16px; border: 1px solid #ccc; border-radius: 20px; background-color: #fff; cursor: pointer; white-space: nowrap; font-size: 14px; }
        .controls button.active { background-color: #007bff; color: #fff; border-color: #007bff; }
        
        .news-list { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .news-card { background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); display: flex; gap: 15px; text-decoration: none; color: #333; transition: transform 0.2s; }
        .news-card:active { transform: scale(0.98); }
        .news-content { flex-grow: 1; }
        .news-title { font-size: 1.1em; font-weight: bold; margin-bottom: 5px; line-height: 1.4; }
        .news-meta { font-size: 0.85em; color: #6c757d; margin-top: 5px; }
        .news-image { width: 100px; height: 80px; object-fit: cover; border-radius: 4px; flex-shrink: 0; background-color: #eee; }
        .status-message { text-align: center; padding: 50px; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h1>å…¨çƒçƒ­ç‚¹æ–°é—»èšåˆ</h1>
    
    <div class="tip-bar">
        ğŸ’¡ æç¤ºï¼šå›½å¤–æ–°é—»æ˜¾ç¤ºä¸ºå¤–è¯­ï¼Ÿ<br>è¯·ç‚¹å‡»æµè§ˆå™¨èœå•çš„ <b>"ç¿»è¯‘..."</b> åŠŸèƒ½ä¸€é”®è½¬ä¸­æ–‡ã€‚
    </div>

    <div class="controls" id="country-controls"></div>
    <div class="news-list" id="news-list">
        <p class="status-message">æ­£åœ¨åŠ è½½æ–°é—»...</p>
    </div>
</div>

<script>
    // =========================================================
    // ğŸ”´ é…ç½®åŒºåŸŸ (è¯·å†æ¬¡ç¡®è®¤è¿™é‡Œï¼) ğŸ”´
    // =========================================================
    
    // 1. æ‚¨çš„ GNews API Key
    const API_KEY = "24f6c5073b941092284245f93c9cb217";
    
    // 2. æ‚¨çš„ Cloudflare Worker çœŸå®ç½‘å€
    // âš ï¸ å¿…é¡»æ›¿æ¢ï¼ä¸è¦ä¿ç•™ "yourname"ï¼
    // ä¾‹å¦‚: https://gnews-proxy.zhangsan-123.workers.dev
    const BASE_URL = "https://gnews-proxy.flyingstar98.workers.dev"; 

    // =========================================================

    // æ‰©å±•åçš„å›½å®¶åˆ—è¡¨
    const COUNTRIES = {
        "us": "ğŸ‡ºğŸ‡¸ ç¾å›½",
        "gb": "ğŸ‡¬ğŸ‡§ è‹±å›½",
        "cn": "ğŸ‡¨ğŸ‡³ ä¸­å›½",
        "jp": "ğŸ‡¯ğŸ‡µ æ—¥æœ¬",
        "kr": "ğŸ‡°ğŸ‡· éŸ©å›½",
        "ru": "ğŸ‡·ğŸ‡º ä¿„ç½—æ–¯",
        "in": "ğŸ‡®ğŸ‡³ å°åº¦",
        "fr": "ğŸ‡«ğŸ‡· æ³•å›½",
        "de": "ğŸ‡©ğŸ‡ª å¾·å›½",
        "it": "ğŸ‡®ğŸ‡¹ æ„å¤§åˆ©",
        "ua": "ğŸ‡ºğŸ‡¦ ä¹Œå…‹å…°"
    };

    let currentCountry = 'us'; 
    const newsListEl = document.getElementById('news-list');
    const controlsEl = document.getElementById('country-controls');

    async function fetchNews(countryCode) {
        // å®‰å…¨æ£€æŸ¥
        if (BASE_URL.includes("yourname.workers.dev")) {
            newsListEl.innerHTML = '<p class="status-message" style="color: red; font-weight:bold;">é…ç½®é”™è¯¯ï¼<br>è¯·åœ¨ä»£ç ä¸­å¡«å…¥æ‚¨çœŸå®çš„ Cloudflare Worker ç½‘å€ã€‚</p>';
            return;
        }

        newsListEl.innerHTML = '<p class="status-message">æ­£åœ¨åŠ è½½ ' + COUNTRIES[countryCode] + ' çš„æ–°é—»...</p>';
        
        try {
            // æ³¨æ„ï¼šæˆ‘ä»¬ä¸åŠ  &lang=zhï¼Œå› ä¸ºåŠ äº†ä¼šå¯¼è‡´å›½å¤–æºæ²¡æ•°æ®ã€‚
            const url = `${BASE_URL}?country=${countryCode}&token=${API_KEY}`;
            const response = await fetch(url);

            // å¤„ç† Worker è¿”å›çš„ 429 é”™è¯¯
            if (response.status === 429) {
                 newsListEl.innerHTML = `<p class="status-message" style="color: red;">API è¯·æ±‚æ¬¡æ•°å·²è€—å°½ (429)ã€‚<br>å…è´¹ç‰ˆæ¯å¤©é™åˆ¶ 100 æ¬¡ï¼Œè¯·æ˜å¤©å†è¯•ã€‚</p>`;
                 return;
            }

            if (!response.ok) {
                 const errorData = await response.json().catch(() => ({}));
                 const errorMessage = errorData.errors ? errorData.errors[0].message : `ä»£ç†è®¿é—®å¤±è´¥ (çŠ¶æ€ç : ${response.status})`;
                 newsListEl.innerHTML = `<p class="status-message" style="color: red;">${errorMessage}</p>`;
                 return;
            }

            const data = await response.json();

            // å¤„ç† GNews ä¸šåŠ¡é”™è¯¯
            if (data.errors) {
                 newsListEl.innerHTML = '<p class="status-message" style="color: red;">API é”™è¯¯: ' + data.errors[0].message + '</p>';
                 return;
            }

            if (data.articles && data.articles.length > 0) {
                renderNews(data.articles);
            } else {
                newsListEl.innerHTML = '<p class="status-message">æœªè·å–åˆ°æ–°é—»ã€‚<br>å¯èƒ½è¯¥å›½å®¶å…è´¹ç‰ˆä¸æ”¯æŒï¼Œæˆ–æš‚æ—¶æ— æ•°æ®ã€‚</p>';
            }

        } catch (error) {
            console.error("Fetch Error:", error);
            newsListEl.innerHTML = '<p class="status-message" style="color: red;">ç½‘ç»œè¿æ¥å¤±è´¥ã€‚<br>è¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®ï¼Œæˆ–å°è¯•åˆ·æ–°é¡µé¢ã€‚</p>';
        }
    }

    function renderNews(articles) {
        newsListEl.innerHTML = ''; 
        articles.forEach(article => {
            if (!article.title || !article.url) return;
            const card = document.createElement('a');
            card.className = 'news-card';
            card.href = article.url;
            card.target = '_blank';
            
            // ç®€å•çš„æ—¥æœŸæ ¼å¼åŒ–
            const dateObj = new Date(article.publishedAt);
            const dateStr = dateObj.toLocaleDateString() + ' ' + dateObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

            card.innerHTML = `
                <div class="news-content">
                    <div class="news-title">${article.title}</div>
                    <div class="news-meta">${article.source.name} Â· ${dateStr}</div>
                </div>
                ${article.image ? `<img src="${article.image}" class="news-image" loading="lazy">` : ''}
            `;
            newsListEl.appendChild(card);
        });
    }

    function setupControls() {
        Object.keys(COUNTRIES).forEach(code => {
            const button = document.createElement('button');
            button.textContent = COUNTRIES[code];
            if (code === currentCountry) button.classList.add('active');
            
            button.onclick = () => {
                document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
                button.classList.add('active');
                currentCountry = code;
                fetchNews(code);
            };
            controlsEl.appendChild(button);
        });
    }

    // åˆå§‹åŒ–
    setupControls();
    fetchNews(currentCountry);
</script>
</body>
</html>
