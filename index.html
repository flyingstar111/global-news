<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒè´¢ç»ä¸åŠ å¯†è´§å¸èšåˆ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f7f9; }
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        h1 { color: #333; text-align: center; margin-bottom: 20px; font-size: 1.5em; }
        
        .tip-bar { background-color: #e3f2fd; color: #0d47a1; padding: 10px; border-radius: 8px; font-size: 0.9em; text-align: center; margin-bottom: 20px; border: 1px solid #bbdefb; }

        /* æ§åˆ¶åŒºå®¹å™¨ */
        .controls-section { margin-bottom: 20px; background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .controls-label { font-size: 0.85em; color: #888; margin-bottom: 8px; font-weight: bold; }
        
        .controls { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .controls::-webkit-scrollbar { display: none; } /* éšè—æ»šåŠ¨æ¡ */
        
        .controls button { padding: 6px 14px; border: 1px solid #eee; border-radius: 18px; background-color: #f8f9fa; cursor: pointer; white-space: nowrap; font-size: 13px; color: #555; transition: all 0.2s; }
        
        /* é€‰ä¸­çŠ¶æ€ï¼šå›½å®¶ç”¨è“è‰² */
        .controls.country-group button.active { background-color: #007bff; color: #fff; border-color: #007bff; box-shadow: 0 2px 5px rgba(0,123,255,0.3); }
        
        /* é€‰ä¸­çŠ¶æ€ï¼šåˆ†ç±»ç”¨ç»¿è‰²ï¼ˆåŒºåˆ†è§†è§‰ï¼‰ */
        .controls.category-group button.active { background-color: #28a745; color: #fff; border-color: #28a745; box-shadow: 0 2px 5px rgba(40,167,69,0.3); }

        .news-list { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .news-card { background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); display: flex; gap: 15px; text-decoration: none; color: #333; transition: transform 0.2s; }
        .news-card:active { transform: scale(0.98); }
        .news-content { flex-grow: 1; }
        .news-title { font-size: 1.1em; font-weight: bold; margin-bottom: 5px; line-height: 1.4; }
        .news-meta { font-size: 0.85em; color: #6c757d; margin-top: 5px; display: flex; align-items: center; gap: 5px; }
        
        /* ç»™ç‰¹å®šåˆ†ç±»åŠ æ ‡ç­¾é¢œè‰² */
        .tag { padding: 2px 6px; border-radius: 4px; font-size: 0.8em; background: #eee; }
        .tag-crypto { background: #fff3cd; color: #856404; }
        .tag-business { background: #d1ecf1; color: #0c5460; }
        
        .news-image { width: 100px; height: 80px; object-fit: cover; border-radius: 4px; flex-shrink: 0; background-color: #eee; }
        .status-message { text-align: center; padding: 50px; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h1>å…¨çƒè´¢ç»ä¸åŠ å¯†è´§å¸èšåˆ</h1>
    
    <div class="tip-bar">
        ğŸ’¡ æç¤ºï¼šç‚¹å‡»å³ä¸Šè§’èœå• <b>"ç¿»è¯‘..."</b> å¯ä¸€é”®æŸ¥çœ‹ä¸­æ–‡æ–°é—»ã€‚
    </div>

    <div class="controls-section">
        <div class="controls-label">1. é€‰æ‹©åœ°åŒº</div>
        <div class="controls country-group" id="country-controls"></div>
    </div>

    <div class="controls-section">
        <div class="controls-label">2. æ–°é—»ç±»åˆ«</div>
        <div class="controls category-group" id="category-controls"></div>
    </div>

    <div class="news-list" id="news-list">
        <p class="status-message">æ­£åœ¨åˆå§‹åŒ–...</p>
    </div>
</div>

<script>
    // =========================================================
    // ğŸ”´ é…ç½®åŒºåŸŸ ğŸ”´
    // =========================================================
    
    const API_KEY = "24f6c5073b941092284245f93c9cb217";
    
    // âš ï¸âš ï¸âš ï¸ è¯·åŠ¡å¿…æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ Worker ç½‘å€ï¼
    const BASE_URL = "https://gnews-proxy.flyingstar998.workers.dev"; 

    // =========================================================

    // å›½å®¶åˆ—è¡¨
    const COUNTRIES = {
        "us": "ğŸ‡ºğŸ‡¸ ç¾å›½",
        "gb": "ğŸ‡¬ğŸ‡§ è‹±å›½",
        "cn": "ğŸ‡¨ğŸ‡³ ä¸­å›½",
        "hk": "ğŸ‡­ğŸ‡° é¦™æ¸¯", // å¢åŠ é¦™æ¸¯ï¼Œé€šå¸¸æœ‰å¾ˆå¤šè´¢ç»æ–°é—»
        "jp": "ğŸ‡¯ğŸ‡µ æ—¥æœ¬",
        "kr": "ğŸ‡°ğŸ‡· éŸ©å›½",
        "sg": "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡", // å¢åŠ æ–°åŠ å¡ï¼ŒåŠ å¯†è´§å¸ä¸­å¿ƒ
        "in": "ğŸ‡®ğŸ‡³ å°åº¦",
        "de": "ğŸ‡©ğŸ‡ª å¾·å›½"
    };

    // æ–°å¢ï¼šæ–°é—»åˆ†ç±»å®šä¹‰
    const CATEGORIES = {
        "general": "ğŸ“° ç»¼åˆå¤´æ¡",
        "business": "ğŸ’° ç»æµé‡‘è",
        "technology": "ğŸ“± ç§‘æŠ€åˆ›æŠ•",
        "crypto": "ğŸª™ åŠ å¯†è´§å¸"  // è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æœç´¢åˆ†ç±»
    };

    let currentCountry = 'us'; 
    let currentCategory = 'general'; // é»˜è®¤åˆ†ç±»

    const newsListEl = document.getElementById('news-list');
    const countryControlsEl = document.getElementById('country-controls');
    const categoryControlsEl = document.getElementById('category-controls');

    async function fetchNews() {
        // å®‰å…¨æ£€æŸ¥
        if (BASE_URL.includes("yourname.workers.dev")) {
            newsListEl.innerHTML = '<p class="status-message" style="color: red; font-weight:bold;">é…ç½®é”™è¯¯ï¼<br>è¯·åœ¨ä»£ç ä¸­å¡«å…¥æ‚¨çœŸå®çš„ Cloudflare Worker ç½‘å€ã€‚</p>';
            return;
        }

        const countryName = COUNTRIES[currentCountry];
        const categoryName = CATEGORIES[currentCategory];
        newsListEl.innerHTML = `<p class="status-message">æ­£åœ¨æœç´¢ <b>${countryName}</b> çš„ <b>${categoryName}</b>...</p>`;
        
        try {
            // æ„å»ºåŸºç¡€ URL
            let url = `${BASE_URL}?token=${API_KEY}&country=${currentCountry}`;

            // æ ¹æ®é€‰æ‹©çš„åˆ†ç±»ï¼Œæ·»åŠ ä¸åŒçš„å‚æ•°
            if (currentCategory === 'business') {
                url += '&topic=business'; // è´¢ç»ä¸»é¢˜
            } else if (currentCategory === 'technology') {
                url += '&topic=technology'; // ç§‘æŠ€ä¸»é¢˜
            } else if (currentCategory === 'crypto') {
                // GNews æ²¡æœ‰ crypto ä¸»é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å…³é”®å­—æœç´¢ (q=crypto)
                // æœç´¢æ—¶å»ºè®®åŠ ä¸Š OR bitcoin ä»¥æ‰©å¤§ç»“æœ
                url += '&q=crypto OR bitcoin OR blockchain'; 
            }
            // å¦‚æœæ˜¯ 'general'ï¼Œæˆ‘ä»¬ä¸åŠ ä»»ä½•é¢å¤–å‚æ•°ï¼Œé»˜è®¤æ˜¾ç¤ºå¤´æ¡

            const response = await fetch(url);

            if (response.status === 429) {
                 newsListEl.innerHTML = `<p class="status-message" style="color: red;">API è¯·æ±‚æ¬¡æ•°å·²è€—å°½ (429)ã€‚<br>è¯·æ˜å¤©å†è¯•ã€‚</p>`;
                 return;
            }

            if (!response.ok) {
                 const errorData = await response.json().catch(() => ({}));
                 const errorMessage = errorData.errors ? errorData.errors[0].message : `ä»£ç†è®¿é—®å¤±è´¥ (${response.status})`;
                 newsListEl.innerHTML = `<p class="status-message" style="color: red;">${errorMessage}</p>`;
                 return;
            }

            const data = await response.json();

            if (data.errors) {
                 newsListEl.innerHTML = '<p class="status-message" style="color: red;">API é”™è¯¯: ' + data.errors[0].message + '</p>';
                 return;
            }

            if (data.articles && data.articles.length > 0) {
                renderNews(data.articles);
            } else {
                newsListEl.innerHTML = '<p class="status-message">è¯¥åˆ†ç±»ä¸‹æš‚æ—¶æ²¡æœ‰æ–°é—»ã€‚<br>è¯·å°è¯•åˆ‡æ¢åˆ°â€œç¾å›½â€æˆ–â€œè‹±å›½â€æºã€‚</p>';
            }

        } catch (error) {
            console.error("Fetch Error:", error);
            newsListEl.innerHTML = '<p class="status-message" style="color: red;">ç½‘ç»œè¿æ¥å¤±è´¥ã€‚<br>è¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®ï¼Œæˆ–å°è¯•åˆ·æ–°é¡µé¢ã€‚</p>';
        }
    }

    function renderNews(articles) {
        newsListEl.innerHTML = ''; 
        articles.forEach(article => {
            if (!article.title || !article.url) return;
            const card = document.createElement('a');
            card.className = 'news-card';
            card.href = article.url;
            card.target = '_blank';
            
            const dateObj = new Date(article.publishedAt);
            const dateStr = dateObj.toLocaleDateString();

            // æ ¹æ®å½“å‰åˆ†ç±»ç”Ÿæˆä¸€ä¸ªå°æ ‡ç­¾
            let tagHtml = '';
            if (currentCategory === 'crypto') tagHtml = '<span class="tag tag-crypto">Crypto</span>';
            if (currentCategory === 'business') tagHtml = '<span class="tag tag-business">Biz</span>';

            card.innerHTML = `
                <div class="news-content">
                    <div class="news-title">${article.title}</div>
                    <div class="news-meta">
                        ${tagHtml}
                        <span>${article.source.name}</span>
                        <span>Â· ${dateStr}</span>
                    </div>
                </div>
                ${article.image ? `<img src="${article.image}" class="news-image" loading="lazy">` : ''}
            `;
            newsListEl.appendChild(card);
        });
    }

    // åˆå§‹åŒ–æŒ‰é’®ç”Ÿæˆé€»è¾‘
    function setupControls() {
        // 1. ç”Ÿæˆå›½å®¶æŒ‰é’®
        Object.keys(COUNTRIES).forEach(code => {
            const button = document.createElement('button');
            button.textContent = COUNTRIES[code];
            if (code === currentCountry) button.classList.add('active');
            
            button.onclick = () => {
                // æ›´æ–° UI
                document.querySelectorAll('.country-group button').forEach(b => b.classList.remove('active'));
                button.classList.add('active');
                // æ›´æ–°æ•°æ®
                currentCountry = code;
                fetchNews();
            };
            countryControlsEl.appendChild(button);
        });

        // 2. ç”Ÿæˆåˆ†ç±»æŒ‰é’®
        Object.keys(CATEGORIES).forEach(cat => {
            const button = document.createElement('button');
            button.textContent = CATEGORIES[cat];
            if (cat === currentCategory) button.classList.add('active');
            
            button.onclick = () => {
                // æ›´æ–° UI
                document.querySelectorAll('.category-group button').forEach(b => b.classList.remove('active'));
                button.classList.add('active');
                // æ›´æ–°æ•°æ®
                currentCategory = cat;
                fetchNews();
            };
            categoryControlsEl.appendChild(button);
        });
    }

    setupControls();
    fetchNews(); // é¦–æ¬¡åŠ è½½
</script>
</body>
</html>
